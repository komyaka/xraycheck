# Скопируйте в .env и при необходимости измените значения.

# ============================================================================
# ОСНОВНЫЕ НАСТРОЙКИ
# ============================================================================

# Режим работы: single - одна ссылка (аргумент или DEFAULT_LIST_URL), merge - объединение ключей из ссылок в LINKS_FILE
MODE=merge

# URL списка VLESS-ключей (по умолчанию, если не передан аргументом; используется при MODE=single)
DEFAULT_LIST_URL=https://raw.githubusercontent.com/EtoNeYaProject/etoneyaproject.github.io/refs/heads/main/cidr

# Файл со ссылками на списки (по одной URL на строку); используется при MODE=merge
LINKS_FILE=links.txt

# Файл для сохранения рабочих ключей (без расширения: available или white-list_available в Docker)
OUTPUT_FILE=available
# Директория для результатов проверки (txt, top100)
OUTPUT_DIR=configs
# Добавлять к имени файла дату и источник (true = available (источник_ДДММГГГГ).txt; false = только OUTPUT_FILE)
OUTPUT_ADD_DATE=false

# URL CIDR whitelist для Docker (ограничение исходящего доступа по подсетям)
CIDR_WHITELIST_URL=https://raw.githubusercontent.com/hxehex/russia-mobile-internet-whitelist/refs/heads/main/cidrwhitelist.txt

# ============================================================================
# ТЕСТОВЫЕ URL
# ============================================================================

# URL для проверки (HTTP, не HTTPS - иначе возможен SSL-ошибка через прокси)
# Устарело: используйте TEST_URLS для множественных URL
TEST_URL=http://www.google.com/generate_204

# Множественные тестовые URL (через запятую или точку с запятой)
# Оптимизация: 1-2 URL достаточно; при первом успехе остальные не проверяются (короткое замыкание)
TEST_URLS=http://www.google.com/generate_204,http://www.cloudflare.com/cdn-cgi/trace

# HTTPS тестовые URL (как в клиентах: gstatic generate_204)
TEST_URLS_HTTPS=https://www.gstatic.com/generate_204

# Требовать хотя бы один успешный HTTPS (рекомендуется для качества)
REQUIRE_HTTPS=true

# ============================================================================
# СТРОГИЙ РЕЖИМ ПРОВЕРКИ (STRONG STYLE)
# ============================================================================

# Строгий режим: как в мобильных клиентах, gstatic/generate_204
STRONG_STYLE_TEST=true

# Таймаут одного запроса в строгом режиме (с); 12 с - ближе к мобильным клиентам
STRONG_STYLE_TIMEOUT=12

# В строгом режиме: макс. время ответа (с); только быстрые ключи
STRONG_MAX_RESPONSE_TIME=3

# В строгом режиме: два запроса подряд, оба должны успешно пройти
STRONG_DOUBLE_CHECK=true

# Сколько подряд успешных запросов к generate_204 требуется (3 = строже)
STRONG_ATTEMPTS=3

# ============================================================================
# ПАРАМЕТРЫ ЗАПРОСОВ
# ============================================================================

# Количество запросов к каждому URL (1 = быстро; 2 = двойная проверка на сбой)
# Ужесточено для строгой проверки: требуется минимум 2 запроса
REQUESTS_PER_URL=2

# Минимальное количество успешных запросов к одному URL
# Ужесточено: требуется минимум 2 успешных запроса из 2
MIN_SUCCESSFUL_REQUESTS=2

# Минимальное количество успешных URL для считания ключа рабочим (2 = оба сервера должны ответить)
MIN_SUCCESSFUL_URLS=2

# Задержка между запросами к одному URL (секунды)
REQUEST_DELAY=0.1

# Таймаут HTTP-запроса через прокси (секунды); ~6 с как у мобильных клиентов
CONNECT_TIMEOUT=6

# Таймаут для медленных соединений (секунды)
CONNECT_TIMEOUT_SLOW=15

# Использовать адаптивные таймауты
USE_ADAPTIVE_TIMEOUT=false

# ============================================================================
# ПОВТОРНЫЕ ПОПЫТКИ
# ============================================================================

# Максимальное количество повторных попыток при ошибке соединения
MAX_RETRIES=1

# Базовая задержка между повторными попытками (секунды)
RETRY_DELAY_BASE=0.5

# Множитель задержки между повторными попытками (экспоненциальная задержка)
RETRY_DELAY_MULTIPLIER=2.0

# ============================================================================
# ПРОВЕРКА ОТВЕТОВ
# ============================================================================

# Максимальное допустимое время ответа (секунды); строже клиента - отсеиваем медленные
MAX_RESPONSE_TIME=6

# Минимальный размер ответа в байтах (0 = не проверять)
MIN_RESPONSE_SIZE=0

# Максимальная задержка (мс): серверы с задержкой выше не попадают в available / white-list_available
MAX_LATENCY_MS=2000

# Проверять SSL при HTTPS-запросах через прокси (по умолчанию false для работы через SOCKS)
VERIFY_HTTPS_SSL=false

# ============================================================================
# ГЕОЛОКАЦИЯ
# ============================================================================

# Проверять геолокацию прокси
CHECK_GEOLOCATION=false

# Сервис для определения геолокации
GEOLOCATION_SERVICE=http://httpbin.org/ip

# Разрешенные страны (через запятую, пусто = все страны)
ALLOWED_COUNTRIES=

# ============================================================================
# ПРОВЕРКА СТАБИЛЬНОСТИ
# ============================================================================

# Количество проверок стабильности
# Ужесточено для строгой проверки: требуется минимум 2 проверки стабильности
STABILITY_CHECKS=2

# Задержка между проверками стабильности (секунды)
STABILITY_CHECK_DELAY=2.0

# ============================================================================
# СТРОГИЙ РЕЖИМ (STRICT MODE)
# ============================================================================

# Режим строгой проверки (выполнять все проверки)
# Включено для строгой проверки: требуется успешное прохождение всех проверок
STRICT_MODE=true

# В строгом режиме требовать успешного прохождения всех проверок
STRICT_MODE_REQUIRE_ALL=true

# ============================================================================
# ПРОИЗВОДИТЕЛЬНОСТЬ И ПАРАЛЛЕЛИЗМ
# ============================================================================

# Число потоков (каждый запускает свой xray) - увеличено для ускорения
MAX_WORKERS=200

# Начальный порт для SOCKS (порты BASE_PORT … BASE_PORT+MAX_WORKERS-1)
BASE_PORT=20000

# ============================================================================
# НАСТРОЙКИ XRAY
# ============================================================================

# Максимальное время ожидания старта xray (секунды) - чуть меньше для скорости
XRAY_STARTUP_WAIT=1.2

# Интервал проверки «жив ли xray» (секунды)
XRAY_STARTUP_POLL_INTERVAL=0.2

# Путь к xray (пусто = искать в PATH, затем автоустановка в xray_dist)
# XRAY_PATH=

# Папка для скачанного Xray (рядом со скриптом)
XRAY_DIR_NAME=xray_dist

# ============================================================================
# ОТЛАДКА
# ============================================================================

# Выводить отладку при первой неудаче (true/false)
DEBUG_FIRST_FAIL=true

# ============================================================================
# ЛОГИРОВАНИЕ
# ============================================================================

# Уровень логирования: DEBUG, INFO, WARNING, ERROR
LOG_LEVEL=INFO

# Файл для сохранения логов (пусто = только консоль)
LOG_FILE=

# Максимальный размер лог-файла в байтах (10MB по умолчанию)
LOG_MAX_SIZE=10485760

# Количество резервных копий лог-файлов
LOG_BACKUP_COUNT=5

# Логировать время ответа в результаты
LOG_RESPONSE_TIME=false

# ============================================================================
# МЕТРИКИ И АНАЛИТИКА
# ============================================================================

# Логировать метрики производительности
LOG_METRICS=false

# Файл для сохранения метрик
METRICS_FILE=metrics.json

# Минимальное среднее время ответа (секунды, 0 = не ограничивать)
MIN_AVG_RESPONSE_TIME=0

# ============================================================================
# ДОПОЛНИТЕЛЬНЫЕ ПРОВЕРКИ
# ============================================================================

# Проверять POST запросы
TEST_POST_REQUESTS=false

# ============================================================================
# КЭШИРОВАНИЕ
# ============================================================================

# Кэширование результатов проверки
ENABLE_CACHE=false

# Время жизни кэша в секундах (3600 = 1 час)
CACHE_TTL=3600

# Файл для хранения кэша
CACHE_FILE=.checker_cache.json

# ============================================================================
# SPEEDTEST (второй уровень, скрипт speedtest_checker.py)
# ============================================================================

# Включить speedtest (true = скрипт работает, false = выход без проверок)
SPEED_TEST_ENABLED=false

# Максимум секунд на конфиг для фазы задержки
SPEED_TEST_TIMEOUT=2

# Режим: latency (только задержка), quick (задержка + загрузка 250KB), full (задержка + загрузка 1MB)
SPEED_TEST_MODE=latency

# Метрика при режиме latency: latency | throughput | hybrid
SPEED_TEST_METRIC=latency

# Куда писать: separate_file = файлы _st и _st(top100)
SPEED_TEST_OUTPUT=separate_file

# Число запросов для фазы задержки
SPEED_TEST_REQUESTS=5

# URL для проверки задержки (generate_204)
SPEED_TEST_URL=https://www.gstatic.com/generate_204

# Потоков для speedtest (рекомендуется не больше MAX_WORKERS)
SPEED_TEST_WORKERS=200

# Макс. секунд на загрузку тестового файла (режимы quick/full)
SPEED_TEST_DOWNLOAD_TIMEOUT=30

# URL для загрузки: маленький файл (quick ~250KB), средний (full ~1MB)
SPEED_TEST_DOWNLOAD_URL_SMALL=https://speed.cloudflare.com/__down?bytes=250000
SPEED_TEST_DOWNLOAD_URL_MEDIUM=https://speed.cloudflare.com/__down?bytes=1000000

# Отсев по скорости по итогам speedtest (Mbps). При quick/full конфиги ниже порога отбрасываются. 0 = не фильтровать
MIN_SPEED_THRESHOLD_MBPS=2.5

# ============================================================================
# ЭКСПОРТ РЕЗУЛЬТАТОВ
# ============================================================================

# Формат экспорта результатов: txt, json, csv, html, all
EXPORT_FORMAT=txt

# Директория для экспорта результатов (если отличается от текущей)
EXPORT_DIR=./exports
